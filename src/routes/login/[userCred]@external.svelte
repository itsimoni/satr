<script lang="ts">
	import { browser } from "$app/env";

	import { goto } from "$app/navigation";

	import supabase from "$lib/db";
	import { nav } from "$lib/stores/nav";
	import { onMount } from "svelte";
	import { fade } from "svelte/transition";

	let errorShown: boolean = false;
	let errorMessage: string = "";

	export let userCred: string = "";

	const loginDetails = userCred.split("**");
	const email = loginDetails[0];
	const password = loginDetails[1];
	console.log(loginDetails);

	const signIn = async () => {
		const {
			user,
			session: supabaseSession,
			error,
		} = await supabase.auth.signIn({
			email,
			password,
		});
		if (error) {
			errorMessage = error.message;
			errorShown = true;
			return;
		} else {
			goto($nav.trade);
		}
	};

	const userId = supabase.auth.session();
	onMount(async () => {
		if (browser && userId !== null) {
			supabase.auth.signOut();
		}
		setTimeout(() => signIn(), 100);
	});
</script>

<div
	class="flex h-screen w-full flex-col items-center justify-center font-inter"
>
	<div class="mt-12 mb-12 flex flex-col items-center">
		<p class="text-6xl font-medium text-white ">Logging In...</p>
		{#if errorShown}
			<div
				class="mt-10 border border-loss px-6 py-3 text-sm text-loss"
				transition:fade
			>
				<span class="mr-1 font-medium">Error -</span>{errorMessage}
			</div>
		{/if}
	</div>
	<a href="https://www.satoshielitebot.us" class="" rel="external"
		><svg
			xmlns="http://www.w3.org/2000/svg"
			class="h-4"
			viewBox="0 0 696.18 95.102"
		>
			<g id="Group_1" data-name="Group 1" transform="translate(0 0.05)">
				<path
					id="Path_1"
					data-name="Path 1"
					d="M1334.89-548.22v77H1324l-4.32-4.91L1260.83-535c-.44.27-.87.57-1.29.88s-1,.8-1.55,1.24a12.3,12.3,0,0,0-1.2,1.12c-5.07,5.06-8.12,12.56-8.12,21.38,0,16.31,10.83,28.56,25.78,28.08a26.87,26.87,0,0,0,20.71-10.37l6.68,6.68a30.571,30.571,0,0,1-10.55,9,36.07,36.07,0,0,1-16.84,4c-20.94,0-36.13-15.76-36.13-37.4,0-11.55,4.23-21.43,11.3-28.13l1-.87a33,33,0,0,1,6.38-4.38,34.449,34.449,0,0,1,7.51-2.88,35.638,35.638,0,0,1,4.09-.8,38.5,38.5,0,0,1,5.2-.34c13.88,0,25.91,7.55,30.82,18.7l-8.38,3.52c-3-6.89-11.21-11.47-18.54-12.77a21.848,21.848,0,0,0-3.9-.35,1,1,0,0,0-.93.43h0c-.07-.41-.14-.41-.21-.4h-.11l1.45,1.45,50,50.16,1-4.08v-57.14Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_2"
					data-name="Path 2"
					d="M1439.89-487.44a19.39,19.39,0,0,1-12.37,3.91,20.69,20.69,0,0,1-11.7-3.34,21.249,21.249,0,0,1-7.71-9.29,32.82,32.82,0,0,1-2.67-13.56,32.68,32.68,0,0,1,2.67-13.6,21.281,21.281,0,0,1,7.71-9.24,20.62,20.62,0,0,1,11.7-3.34A19.691,19.691,0,0,1,1440-532a19.11,19.11,0,0,1,6.77,10.78h11.81a29.75,29.75,0,0,0-5.24-13.19,27.1,27.1,0,0,0-10.62-8.78,33.778,33.778,0,0,0-14.64-3.08,35.78,35.78,0,0,0-18.33,4.57,30.86,30.86,0,0,0-12.11,12.83,41.251,41.251,0,0,0-4.26,19.15,41.51,41.51,0,0,0,4.26,19.26,30.56,30.56,0,0,0,12.11,12.78,36.161,36.161,0,0,0,18.33,4.52,33.81,33.81,0,0,0,14.69-3.08,27.1,27.1,0,0,0,10.52-8.73,29.769,29.769,0,0,0,5.19-13.25h-11.81A19.18,19.18,0,0,1,1439.89-487.44Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_3"
					data-name="Path 3"
					d="M1494.42-527.22q-6.08,0-9.67,2.23a17.15,17.15,0,0,0-5.86,6.15l-1.24-8.38h-9.76v53h11v-25.23c0-4.86,1-8.88,3.08-12s5.38-4.74,10-4.74h4.94v-11Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_4"
					data-name="Path 4"
					d="M1540-526.22l-14.25,40.5-14.65-40.5h-11.78l20.43,52.69-2.15,5q-1.33,3.38-2.56,4.35c-.81.64-2.28,1-4.38,1h-7.77v10h11.9a12.23,12.23,0,0,0,6-1.28,10.6,10.6,0,0,0,3.8-3.79,48.313,48.313,0,0,0,3.38-7.23l23.79-60.7Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_5"
					data-name="Path 5"
					d="M1606.28-514.28a22.171,22.171,0,0,0-8.75-9.32,25,25,0,0,0-12.73-3.24,20.2,20.2,0,0,0-17,8.41l-1.32-7.79h-9.58v73h11v-27.89a17.922,17.922,0,0,0,6.82,5.84,22.17,22.17,0,0,0,10.09,2.16,24.431,24.431,0,0,0,12.73-3.33,22.9,22.9,0,0,0,8.75-9.44,30.06,30.06,0,0,0,3.17-14.1,30.551,30.551,0,0,0-3.18-14.3Zm-11.64,26.49a14,14,0,0,1-11.14,4.93,13.86,13.86,0,0,1-11.09-4.93q-4.22-4.92-4.21-12.83,0-7.69,4.21-12.48a14.08,14.08,0,0,1,11.09-4.77,14.17,14.17,0,0,1,11.14,4.82q4.26,4.83,4.26,12.63t-4.26,12.63Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_6"
					data-name="Path 6"
					d="M1638.38-484.22c-2,0-3.41-.44-4.25-1.32s-1.24-2.37-1.24-4.47v-27.21h13v-9h-13v-15h-11v15h-9v9h9v28.67q0,7.32,3.39,10.83t10.77,3.5h10.84v-10Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_7"
					data-name="Path 7"
					d="M1700.31-514.43a23.67,23.67,0,0,0-9.45-9.5,28.409,28.409,0,0,0-14-3.39,28.371,28.371,0,0,0-14,3.39,23.61,23.61,0,0,0-9.45,9.5,28.79,28.79,0,0,0-3.34,14,29,29,0,0,0,3.34,14.12,23.191,23.191,0,0,0,9.45,9.45,28.68,28.68,0,0,0,14,3.34,28.72,28.72,0,0,0,14-3.34,23.249,23.249,0,0,0,9.45-9.45,29,29,0,0,0,3.33-14.12,28.791,28.791,0,0,0-3.33-14Zm-12.22,26.59a14.21,14.21,0,0,1-11.25,4.88,14.06,14.06,0,0,1-11.19-4.88q-4.22-4.87-4.21-12.58t4.21-12.57a14,14,0,0,1,11.19-4.88,14.18,14.18,0,0,1,11.25,4.88q4.26,4.88,4.26,12.57t-4.26,12.58Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_8"
					data-name="Path 8"
					d="M1756-522q-5.91-5.79-15.28-5.79-10.9,0-16.88,7.56l-1.24-6.94h-9.67v53h11v-26.49q0-8,3.81-12.58t10.48-4.57c4.16,0,7.33,1.3,9.48,3.9s3.23,6.4,3.23,11.4v28.34h11v-29.2Q1761.89-516.23,1756-522Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_9"
					data-name="Path 9"
					d="M1818.88-498.22a29.558,29.558,0,0,0,.3-4,25.262,25.262,0,0,0-3.3-12.7,22,22,0,0,0-8.76-8.37,27.091,27.091,0,0,0-12.84-2.95,25,25,0,0,0-12.75,3.2,22.131,22.131,0,0,0-8.66,9.06,28.761,28.761,0,0,0-3.1,13.63,27.532,27.532,0,0,0,3.2,13.48,22.41,22.41,0,0,0,9,9,28.138,28.138,0,0,0,13.73,3.2q9.06,0,15.11-4.92a20.41,20.41,0,0,0,7.43-12.6h-10.63a11,11,0,0,1-4.43,6.55,14.18,14.18,0,0,1-8.26,2.31,13.23,13.23,0,0,1-9.94-3.84c-2.5-2.56-3.87-6-4.14-10.43v-.59Zm-32.73-16.88a14.13,14.13,0,0,1,9.4-3.33,14.549,14.549,0,0,1,9.7,3.23,13.391,13.391,0,0,1,4.57,9h-28.24a13.11,13.11,0,0,1,4.57-8.9Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_10"
					data-name="Path 10"
					d="M1849.38-484.22c-2,0-3.41-.44-4.25-1.32s-1.24-2.37-1.24-4.47v-27.21h13v-9h-13v-15h-11v15h-9v9h9v28.67q0,7.32,3.39,10.83c2.25,2.34,5.85,3.5,10.76,3.5h10.85v-10Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_11"
					data-name="Path 11"
					d="M1863.89-527.22v53h11v-53Zm10.52-18.63a6.63,6.63,0,0,0-4.82-1.9,6.64,6.64,0,0,0-4.83,1.9,6.38,6.38,0,0,0-2,4.77,6.4,6.4,0,0,0,2,4.78,6.679,6.679,0,0,0,4.83,1.9,6.67,6.67,0,0,0,4.82-1.9,6.4,6.4,0,0,0,1.95-4.78,6.379,6.379,0,0,0-1.95-4.77Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
				<path
					id="Path_12"
					data-name="Path 12"
					d="M1918.78-485.87a13.251,13.251,0,0,1-8.53,2.72,13.26,13.26,0,0,1-10.74-4.89q-4.07-4.87-4.06-12.68t4.06-12.54a13.35,13.35,0,0,1,10.74-4.82,13,13,0,0,1,8.32,2.67,12.759,12.759,0,0,1,4.52,7.19h11.41a22.7,22.7,0,0,0-7.81-14.13q-6.27-5.19-16.14-5.19a28.16,28.16,0,0,0-13.92,3.34,23.249,23.249,0,0,0-9.3,9.4,29.079,29.079,0,0,0-3.29,14.08,30.069,30.069,0,0,0,3.24,14.18,22.781,22.781,0,0,0,9.2,9.5,27.661,27.661,0,0,0,13.77,3.34q10,0,16.33-5.19t7.92-14.33h-11.3a12.63,12.63,0,0,1-4.42,7.35Z"
					transform="translate(-1238.32 548.22)"
					fill="#fff"
				/>
			</g>
		</svg>
	</a>
</div>
